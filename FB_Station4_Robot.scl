FUNCTION_BLOCK "FB_Station4_Robot"
{ S7_Optimized_Access := 'TRUE' }
VERSION : 0.1
   VAR_IN_OUT 
      Data_Stn4 : "typeCarriageData";
   END_VAR

   VAR_INPUT
      b_Reset : BOOL;
      b_enable : BOOL;
   END_VAR
   
   VAR_OUTPUT 
       bPrgrReadyForRobot : BOOL; // Note: Logic might be redundant if St3 drives these, but St4 holds the valid item.
       nPrgrNr_Robot : DINT;
   END_VAR
   
BEGIN
    // Simple pass through of data if valid
    IF #b_Reset THEN
        #bPrgrReadyForRobot := FALSE;
        #nPrgrNr_Robot := 0;
        
    ELSIF #b_enable THEN
        IF #Data_Stn4.bDataValid THEN
            #nPrgrNr_Robot := #Data_Stn4.nProgrNumber;
            // In this architecture, St3 decides if it's "Ready" (OK vs NOK) 
            // But St4 holds the item physically. 
            // If St3 checked it as OK, it's implicitly ready unless we need another handshake.
            #bPrgrReadyForRobot := TRUE;
        ELSE
            #bPrgrReadyForRobot := FALSE;
            #nPrgrNr_Robot := 0;
        END_IF;
    END_IF;

END_FUNCTION_BLOCK
